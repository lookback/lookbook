#!/usr/bin/env bash

file=src/lookbook.css
dir=dist

ext_min_maps=dist.css
ext_min=bare.css

echo "üïê Building $file..."

# Emit minified and sourcemapped dist/lookbook.dist.css
NODE_ENV='production' npx postcss "$file" --dir "$dir" --ext "$ext_min_maps" "$@"

status=$?

# Emit non-minified dist/lookbook.css
# Meant for being included in other projects, before minification and source mapping
NODE_ENV='development' npx postcss "$file" --no-map --dir "$dir" "$@"

# Emit minified, non-sourcemap dist/lookbook.bare.css
NODE_ENV='production' npx postcss "$file" --no-map --ext "$ext_min" --dir "$dir" "$@"

size_nonminified="$(ls -lah dist/lookbook.css | awk -F " " {'print $5'})"
echo "‚úÖ Built non-minified version into $dir/lookbook.css ($size_nonminified)"

size_nonmap="$(ls -lah dist/lookbook.$ext_min | awk -F " " {'print $5'})"
echo "‚úÖ Built minified version into $dir/lookbook.$ext_min ($size_nonmap)"

size="$(ls -lah dist/lookbook.$ext_min_maps | awk -F " " {'print $5'})"

echo "‚úÖ Built minified version (with sourcemaps) into $dir/lookbook.$ext_min_maps ($size)" && exit $status
